/* jshint strict:false,expr:true */
/* global describe, it, expect, beforeEach, afterEach, sinon */

moduleDescribe('waf/Dom/Dom', function() {
var json = {'document':[{'nodeType':10,'name':'html'},{'nodeType':1,'nodeName':'html','childNodes':[{'nodeType':3,'nodeValue':' '},{'nodeType':1,'nodeName':'head','childNodes':[{'nodeType':3,'nodeValue':' '},{'nodeType':1,'nodeName':'title','childNodes':[{'nodeType':3,'nodeValue':'fffff'}]},{'nodeType':3,'nodeValue':' '},{'nodeType':1,'nodeName':'meta','attributes':{'http-equiv':'Content-Type','content':'text/html; charset=UTF-8'}},{'nodeType':3,'nodeValue':' '},{'nodeType':1,'nodeName':'meta','attributes':{'name':'generator','content':'Wakanda GUIDesigner'}},{'nodeType':3,'nodeValue':' '},{'nodeType':1,'nodeName':'meta','attributes':{'http-equiv':'X-UA-Compatible','content':'IE=Edge'}},{'nodeType':3,'nodeValue':' '},{'nodeType':1,'nodeName':'meta','attributes':{'name':'wakanda-version','content':'Dev'}},{'nodeType':1,'nodeName':'meta','attributes':{'name':'wakanda-build','content':'0001'}},{'nodeType':1,'nodeName':'meta','attributes':{'name':'viewport','content':'width=device-width, initial-scale=1.0, maximum-scale=1, minimum-scale=1.0'}},{'nodeType':1,'nodeName':'meta','attributes':{'id':'waf-palette','name':'WAF.config.loadCSS','content':'/walib/WAF/widget/palette/css/widget-palette-cupertino.css'}},{'nodeType':1,'nodeName':'meta','attributes':{'data-type':'dataSource','data-lib':'WAF','data-source':'Employees','data-source-type':'dataClass','data-dataType':'string','data-autoLoad':'true','name':'WAF.config.datasources','data-id':'employees','content':'employees'}},{'nodeType':1,'nodeName':'meta','attributes':{'id':'waf-interface-css','name':'WAF.config.loadCSS','content':'styles/.css'}},{'nodeType':1,'nodeName':'meta','attributes':{'id':'waf-project-css','name':'WAF.config.loadCSS','content':'/application.css'}},{'nodeType':1,'nodeName':'meta','attributes':{'name':'WAF.config.modules','content':'tablet'}},{'nodeType':1,'nodeName':'meta','attributes':{'name':'WAF.config.loadCSS','content':'waf-container'}}]},{'nodeType':3,'nodeValue':' '},{'nodeType':1,'nodeName':'body','childNodes':[{'nodeType':3,'nodeValue':' '},{'nodeType':1,'nodeName':'label','attributes':{'id':'label1','data-type':'label','data-lib':'WAF','for':'section1','data-valign':'middle','data-margin':'5','class':'waf-widget waf-label cupertino inherited waf-label-section ','data-constraint-left':'true','data-constraint-top':'true','data-context':'[\"allowResizeX\"]'},'childNodes':[{'nodeType':3,'nodeValue':'SectionLabel'}]},{'nodeType':1,'nodeName':'div','attributes':{'id':'section1','data-type':'section','data-lib':'WAF','class':'waf-widget waf-section cupertino inherited ','data-label':'SectionLabel','data-label-position':'top','data-constraint-left':'true','data-constraint-top':'true','data-context':'[\"allowResizeX\"]','data-linked-tag':'container1,container3,container5,container7,container9','data-items':'[{\"type\":\"Label\"},{\"type\":\"Switch\"},{\"type\":\"Input\"},{\"type\":\"Navigation\"},{\"type\":\"Blank\"}]'},'childNodes':[{'nodeType':3,'nodeValue':' '},{'nodeType':1,'nodeName':'div','attributes':{'id':'container1','data-type':'container','data-lib':'WAF','class':'waf-widget waf-container cupertino inherited waf-section-label waf-element-first','data-label-position':'top','data-rowIndex':'0','data-context':'[\"protected\"]','data-rowType':'Label','data-constraint-left':'true','data-label':'','data-constraint-top':'true','data-linked-tag':'richText1','data-constraint-bottom':'false','data-constraint-right':'true'},'childNodes':[{'nodeType':3,'nodeValue':' '},{'nodeType':1,'nodeName':'div','attributes':{'id':'richText1','data-type':'richText','data-lib':'WAF','class':'waf-widget waf-richText cupertino inherited ','data-autoWidth':'true','data-label-position':'left','data-target':'_blank','data-overflow':'Hidden','data-plainText':'true','data-context':'[\"protected\"]','data-constraint-left':'true','data-label':'','data-constraint-top':'true','data-inline':'true','data-constraint-bottom':'true','data-constraint-right':'false'},'childNodes':[{'nodeType':3,'nodeValue':'Section1'}]},{'nodeType':3,'nodeValue':' '}]},{'nodeType':3,'nodeValue':' '},{'nodeType':1,'nodeName':'div','attributes':{'id':'container3','data-type':'sectionNavigation','data-lib':'WAF','class':'waf-widget waf-sectionNavigation cupertino inherited waf-container waf-section-switch ','data-showImage':'false','data-rowIndex':'1','data-context':'[\"protected\"]','data-rowType':'Switch','data-constraint-left':'true','data-constraint-top':'true','data-constraint-bottom':'false','data-constraint-right':'true','data-linked-tag':'switchbox1,richText3'},'childNodes':[{'nodeType':3,'nodeValue':' '},{'nodeType':1,'nodeName':'div','attributes':{'id':'switchbox1','data-type':'switchbox','data-lib':'WAF','type':'checkbox','class':'waf-widget waf-switchbox cupertino inherited ','data-off':'OFF','data-on':'ON','data-label-position':'left','data-context':'[\"protected\",\"allowBind\"]','data-constraint-left':'false','data-label':'','data-constraint-top':'true','data-constraint-bottom':'false','data-constraint-right':'true'}},{'nodeType':3,'nodeValue':' '},{'nodeType':1,'nodeName':'div','attributes':{'id':'richText3','data-type':'richText','data-lib':'WAF','class':'waf-widget waf-richText cupertino inherited ','data-autoWidth':'true','data-label-position':'left','data-target':'_blank','data-overflow':'Hidden','data-plainText':'true','data-context':'[\"protected\"]','data-constraint-left':'true','data-label':'','data-constraint-top':'true','data-inline':'true','data-constraint-bottom':'true','data-constraint-right':'false'},'childNodes':[{'nodeType':3,'nodeValue':'Section2'}]},{'nodeType':3,'nodeValue':' '}]},{'nodeType':3,'nodeValue':' '},{'nodeType':1,'nodeName':'div','attributes':{'id':'container5','data-type':'container','data-lib':'WAF','class':'waf-widget waf-container cupertino inherited waf-section-input ','data-label-position':'top','data-rowIndex':'2','data-context':'[\"protected\"]','data-rowType':'Input','data-constraint-left':'true','data-label':'','data-constraint-top':'true','data-constraint-bottom':'false','data-constraint-right':'true','data-linked-tag':'textField1,richText5'},'childNodes':[{'nodeType':3,'nodeValue':' '},{'nodeType':1,'nodeName':'input','attributes':{'id':'textField1','data-type':'textField','data-lib':'WAF','type':'text','class':'waf-widget waf-textField cupertino inherited ','data-label-position':'left','data-multiline':'false','data-readOnly':'false','data-password':'false','data-datapicker-on':'true','data-datapicker-icon-only':'false','data-context':'[\"protected\",\"allowBind\"]','data-constraint-left':'true','data-label':'','data-constraint-top':'true','data-constraint-bottom':'false','data-constraint-right':'true','data-binding':'employees.firstName'}},{'nodeType':3,'nodeValue':' '},{'nodeType':1,'nodeName':'div','attributes':{'id':'richText5','data-type':'richText','data-lib':'WAF','class':'waf-widget waf-richText cupertino inherited ','data-autoWidth':'true','data-label-position':'left','data-target':'_blank','data-overflow':'Hidden','data-plainText':'true','data-context':'[\"protected\"]','data-constraint-left':'true','data-label':'','data-constraint-top':'true','data-inline':'true','data-labelFor':'textField1','data-constraint-bottom':'true','data-constraint-right':'false'},'childNodes':[{'nodeType':3,'nodeValue':'Section3'}]},{'nodeType':3,'nodeValue':' '}]},{'nodeType':3,'nodeValue':' '},{'nodeType':1,'nodeName':'div','attributes':{'id':'container7','data-type':'sectionNavigation','data-lib':'WAF','class':'waf-widget waf-sectionNavigation cupertino inherited waf-container waf-section-nav ','data-showImage':'false','data-rowIndex':'3','data-context':'[\"protected\"]','data-rowType':'NavBar','data-constraint-left':'true','data-constraint-top':'true','data-constraint-bottom':'false','data-constraint-right':'true','data-linked-tag':'button1,richText7'},'childNodes':[{'nodeType':3,'nodeValue':' '},{'nodeType':1,'nodeName':'button','attributes':{'id':'button1','data-type':'button','data-lib':'WAF','class':'waf-widget waf-button cupertino inherited waf-section-nav-buttonGoTo ','data-action':'simple','data-text':' ','data-target':'_blank','data-context':'[\"protected\"]','data-constraint-left':'false','data-constraint-top':'true','data-constraint-bottom':'false','data-constraint-right':'true','data-link':'www.google.com'}},{'nodeType':3,'nodeValue':' '},{'nodeType':1,'nodeName':'div','attributes':{'id':'richText7','data-type':'richText','data-lib':'WAF','class':'waf-widget waf-richText cupertino inherited ','data-autoWidth':'true','data-label-position':'left','data-target':'_blank','data-overflow':'Hidden','data-plainText':'true','data-context':'[\"protected\"]','data-constraint-left':'true','data-label':'','data-constraint-top':'true','data-inline':'true','data-constraint-bottom':'true','data-constraint-right':'false'},'childNodes':[{'nodeType':3,'nodeValue':'Section4'}]},{'nodeType':3,'nodeValue':' '}]},{'nodeType':3,'nodeValue':' '},{'nodeType':1,'nodeName':'div','attributes':{'id':'container9','data-type':'container','data-lib':'WAF','class':'waf-widget waf-container cupertino inherited waf-container-level-0 waf-level-0 waf-section-blank waf-element-last','data-label-position':'top','data-rowIndex':'4','data-rowType':'Blank','data-constraint-left':'true','data-label':'','data-constraint-top':'true','data-constraint-bottom':'false','data-constraint-right':'true','data-context':'[\"disallowResize\"]'}},{'nodeType':3,'nodeValue':' '}]}],'attributes':{'id':'waf-body','data-type':'document','data-lib':'WAF','data-platform':'tablet','data-viewport-width':'device-width','data-viewport-initial-scale':'1.0','data-viewport-maximum-scale':'1.0','data-viewport-minimum-scale':'1.0','data-apple-meta-tags-status-bar':'default','data-workspace-device':'Apple iPad','data-workspace-orientation':'landscape','data-workspace-width':'1024','data-workspace-height':'768','class':'cupertino','data-theme':'cupertino','data-group':'[[\"section1\",\"container1\",\"richText1\",\"container3\",\"richText3\",\"switchbox1\",\"container5\",\"richText5\",\"textField1\",\"container7\",\"richText7\",\"button1\",\"container9\"]]','style':'visibility:hidden;'}}]}]};
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
    describe('JSON to document', function() {
        var doc; 

        beforeEach(function() {
            doc = new WAF.dom.HTMLDocument(json);
        });

        it('should have body with 3 childNodes', function() {
            expect(doc).to.have.property('body').to.have.property('_json').to.have.property('childNodes').with.length(3);
        });

        it('should have head with 18 childNodes', function() {
            expect(doc).to.have.property('head').to.have.property('_json').to.have.property('childNodes').with.length(18);
        });
    });

    describe('Dom.removeNode', function() {
        var doc;

        beforeEach(function() {
            doc = new WAF.dom.HTMLDocument(json);
        });

        it('should remove node', function() {
            doc.removeNode('meta', 'id', 'waf-palette');
            expect(doc.getElementsByAttribute('meta', 'id', 'waf-palette')).to.be.an('array').with.length(0);
        });

        it('should only remove node (#WAK0087566: removeNode used to remove 2 elements since 2010)', function() {
            doc.removeNode('meta', 'id', 'waf-palette');
            expect(doc).to.have.property('head').to.have.property('_json').to.have.property('childNodes').with.length(17);
        });
    });
});
